import{a as z,d as b,h as T}from"./chunk-XP46ZQI7.js";import{b as K,e as J,h as Q,i as Y,j as Z,l as ee}from"./chunk-C4CLRZFR.js";import{$a as g,Cb as $,Db as H,Fb as q,Ga as B,Gb as X,Ka as I,Ra as y,Ta as p,Ua as f,V as L,Wa as N,Xa as x,Ya as M,a as E,aa as A,ab as P,ba as k,c as ae,cb as U,d as se,db as D,e as _,eb as O,fb as G,hb as V,jb as W,xa as u}from"./chunk-WRYOPP3C.js";var te=ae((j,F)=>{"use strict";(function(l,a){typeof define=="function"&&define.amd?define([],a):typeof j<"u"?a():(a(),l.FileSaver={})})(j,function(){"use strict";function l(t,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob(["\uFEFF",t],{type:t.type}):t}function a(t,n,d){var o=new XMLHttpRequest;o.open("GET",t),o.responseType="blob",o.onload=function(){w(o.response,n,d)},o.onerror=function(){console.error("could not download file")},o.send()}function e(t){var n=new XMLHttpRequest;n.open("HEAD",t,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function i(t){try{t.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),t.dispatchEvent(n)}}var r=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof global=="object"&&global.global===global?global:void 0,m=r.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),w=r.saveAs||(typeof window!="object"||window!==r?function(){}:"download"in HTMLAnchorElement.prototype&&!m?function(t,n,d){var o=r.URL||r.webkitURL,c=document.createElement("a");n=n||t.name||"download",c.download=n,c.rel="noopener",typeof t=="string"?(c.href=t,c.origin===location.origin?i(c):e(c.href)?a(t,n,d):i(c,c.target="_blank")):(c.href=o.createObjectURL(t),setTimeout(function(){o.revokeObjectURL(c.href)},4e4),setTimeout(function(){i(c)},0))}:"msSaveOrOpenBlob"in navigator?function(t,n,d){if(n=n||t.name||"download",typeof t!="string")navigator.msSaveOrOpenBlob(l(t,d),n);else if(e(t))a(t,n,d);else{var o=document.createElement("a");o.href=t,o.target="_blank",setTimeout(function(){i(o)})}}:function(t,n,d,o){if(o=o||open("","_blank"),o&&(o.document.title=o.document.body.innerText="downloading..."),typeof t=="string")return a(t,n,d);var c=t.type==="application/octet-stream",R=/constructor/i.test(r.HTMLElement)||r.safari,C=/CriOS\/[\d]+/.test(navigator.userAgent);if((C||c&&R||m)&&typeof FileReader<"u"){var s=new FileReader;s.onloadend=function(){var h=s.result;h=C?h:h.replace(/^data:[^;]*;/,"data:attachment/file;"),o?o.location.href=h:location=h,o=null},s.readAsDataURL(t)}else{var v=r.URL||r.webkitURL,S=v.createObjectURL(t);o?o.location=S:location.href=S,o=null,setTimeout(function(){v.revokeObjectURL(S)},4e4)}});r.saveAs=w.saveAs=w,typeof F<"u"&&(F.exports=w)})});var oe=se(te());function re(l,a){if(l&1&&(p(0,"option",10),g(1),f()),l&2){let e=a.$implicit;y("value",e.id),u(),P(e.name)}}function le(l,a){if(l&1&&(p(0,"option",10),g(1),V(2,"date"),f()),l&2){let e=a.$implicit;y("value",e.id),u(),U(" ",!(e.date==null||e.date.toDate==null)&&e.date.toDate()?W(2,3,e.date.toDate(),"mediumDate"):e.date," vs ",e.opponent," ")}}function ce(l,a){if(l&1){let e=N();p(0,"div",2)(1,"label",11),g(2,"Select Game"),f(),p(3,"select",12),G("ngModelChange",function(r){A(e);let m=M();return O(m.selectedGameId,r)||(m.selectedGameId=r),k(r)}),p(4,"option",5),g(5,"-- Choose a Game --"),f(),I(6,le,3,6,"option",6),f()()}if(l&2){let e=M();u(3),D("ngModel",e.selectedGameId),u(3),y("ngForOf",e.games)}}var ne=class l{firestore=L(z);teams=[];games=[];selectedTeamId="";selectedGameId="";ngOnInit(){return _(this,null,function*(){yield this.loadTeams()})}loadTeams(){return _(this,null,function*(){let a=b(this.firestore,"teams"),e=yield T(a);this.teams=e.docs.map(i=>({id:i.id,name:i.data().name||"Unnamed"}))})}onTeamSelect(){return _(this,null,function*(){if(!this.selectedTeamId)return;let a=b(this.firestore,`teams/${this.selectedTeamId}/games`),e=yield T(a);this.games=e.docs.map(i=>E({id:i.id},i.data()))})}exportSelectedGameToCSV(){return _(this,null,function*(){if(!this.selectedTeamId||!this.selectedGameId)return;let a=this.teams.find(s=>s.id===this.selectedTeamId),e=this.games.find(s=>s.id===this.selectedGameId);if(!e)return;let i=yield T(b(this.firestore,`teams/${this.selectedTeamId}/roster`)),r=yield T(b(this.firestore,`teams/${this.selectedTeamId}/games/${this.selectedGameId}/stats`)),m=i.docs.map(s=>E({id:s.id},s.data())),w=Object.fromEntries(r.docs.map(s=>[s.id,s.data()])),t=["Team","Game Date","Opponent","Player Name","Number","Position","Points","Assists","Rebounds","Score"],n=[],d=0;for(let s of m){let v=w[s.id]||{points:0,assists:0,rebounds:0};d+=v.points;let S=e.date?.toDate?.()?e.date.toDate().toISOString().split("T")[0]:e.date,h=[a?.name||"",S,e.opponent||"",s.name,s.number,s.position,v.points,v.assists,v.rebounds,""];n.push(h.map(ie=>`"${ie}"`).join(","))}let o=`${d}-??`,c=n.map(s=>s.replace(/,""$/,`,"${o}"`)),R=[t.join(","),...c].join(`
`),C=new Blob([R],{type:"text/csv;charset=utf-8;"});(0,oe.saveAs)(C,`game_${this.selectedGameId}_players.csv`)})}static \u0275fac=function(e){return new(e||l)};static \u0275cmp=B({type:l,selectors:[["app-reports"]],decls:14,vars:4,consts:[[1,"container","mt-5"],[1,"text-center","mb-4"],[1,"mb-3"],["for","teamSelect",1,"form-label"],["id","teamSelect",1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","mb-3",4,"ngIf"],[1,"text-center","mt-4"],[1,"btn","btn-success",3,"click","disabled"],[3,"value"],["for","gameSelect",1,"form-label"],["id","gameSelect",1,"form-select",3,"ngModelChange","ngModel"]],template:function(e,i){e&1&&(p(0,"div",0)(1,"h3",1),g(2,"Export Game Data"),f(),p(3,"div",2)(4,"label",3),g(5,"Select Team"),f(),p(6,"select",4),G("ngModelChange",function(m){return O(i.selectedTeamId,m)||(i.selectedTeamId=m),m}),x("change",function(){return i.onTeamSelect()}),p(7,"option",5),g(8,"-- Choose a Team --"),f(),I(9,re,2,2,"option",6),f()(),I(10,ce,7,2,"div",7),p(11,"div",8)(12,"button",9),x("click",function(){return i.exportSelectedGameToCSV()}),g(13,"Export Selected Game to CSV"),f()()()),e&2&&(u(6),D("ngModel",i.selectedTeamId),u(3),y("ngForOf",i.teams),u(),y("ngIf",i.selectedTeamId),u(2),y("disabled",!i.selectedGameId))},dependencies:[X,$,H,q,ee,Y,Z,Q,K,J],styles:["[_nghost-%COMP%]{display:block;padding-top:70px;position:relative;z-index:1}"]})};export{ne as ReportsComponent};
