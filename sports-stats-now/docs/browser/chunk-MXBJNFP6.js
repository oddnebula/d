import{a as k,c as D,d as g,e as V,f as M,g as B,h as b,m as I}from"./chunk-XP46ZQI7.js";import{a as L,b as A,c as j,d as q,e as z,f as U,g as H,h as J,i as K,j as Q,k as X,l as Y}from"./chunk-C4CLRZFR.js";import{$a as r,Ba as P,Cb as $,Db as N,Ga as F,Gb as R,Ka as C,Ra as S,Ta as a,Ua as s,Wa as E,Xa as w,Ya as p,Za as T,a as v,aa as u,ab as G,ba as _,cb as O,db as f,e as c,eb as h,fb as y,xa as l}from"./chunk-WRYOPP3C.js";function te(m,o){if(m&1&&(a(0,"option",16),r(1),s()),m&2){let e=o.$implicit;S("value",e.id),l(),G(e.name)}}function ne(m,o){if(m&1){let e=E();a(0,"li",17)(1,"span"),r(2),s(),a(3,"div",18)(4,"button",19),w("click",function(){let n=u(e).$implicit,i=p();return _(i.selectGame(n.id))}),r(5,"Enter Stats"),s(),a(6,"button",20),w("click",function(){let n=u(e).$implicit,i=p();return _(i.deleteGame(n.id))}),r(7,"Delete"),s()()()}if(m&2){let e=o.$implicit;l(2),O("",e.date," vs ",e.opponent,"")}}function ie(m,o){if(m&1){let e=E();a(0,"tr")(1,"td"),r(2),s(),a(3,"td"),r(4),s(),a(5,"td"),r(6),s(),a(7,"td")(8,"input",23),y("ngModelChange",function(n){let i=u(e).$implicit,d=p(2);return h(d.playerStatsMap[i.id].points,n)||(d.playerStatsMap[i.id].points=n),_(n)}),s()(),a(9,"td")(10,"input",23),y("ngModelChange",function(n){let i=u(e).$implicit,d=p(2);return h(d.playerStatsMap[i.id].assists,n)||(d.playerStatsMap[i.id].assists=n),_(n)}),s()(),a(11,"td")(12,"input",23),y("ngModelChange",function(n){let i=u(e).$implicit,d=p(2);return h(d.playerStatsMap[i.id].rebounds,n)||(d.playerStatsMap[i.id].rebounds=n),_(n)}),s()(),a(13,"td")(14,"button",24),w("click",function(){let n=u(e).$implicit,i=p(2);return _(i.saveStats(n.id))}),r(15,"Save"),s()()()}if(m&2){let e=o.$implicit,t=p(2);l(2),G(e.name),l(2),G(e.number),l(2),G(e.position),l(2),T("name","pts",e.id,""),f("ngModel",t.playerStatsMap[e.id].points),l(2),T("name","ast",e.id,""),f("ngModel",t.playerStatsMap[e.id].assists),l(2),T("name","reb",e.id,""),f("ngModel",t.playerStatsMap[e.id].rebounds)}}function ae(m,o){if(m&1&&(a(0,"div")(1,"h5"),r(2,"Enter Stats"),s(),a(3,"table",21)(4,"thead")(5,"tr")(6,"th"),r(7,"Player"),s(),a(8,"th"),r(9,"#"),s(),a(10,"th"),r(11,"Pos"),s(),a(12,"th"),r(13,"Points"),s(),a(14,"th"),r(15,"Assists"),s(),a(16,"th"),r(17,"Rebounds"),s(),a(18,"th"),r(19,"Save"),s()()(),a(20,"tbody"),C(21,ie,16,12,"tr",22),s()()()),m&2){let e=p();l(21),S("ngForOf",e.players)}}var Z=class m{constructor(o){this.firestore=o}teams=[];selectedTeamId="";games=[];selectedGameId=null;opponent="";date="";players=[];playerStatsMap={};score="";ngOnInit(){return c(this,null,function*(){yield this.loadTeams()})}loadTeams(){return c(this,null,function*(){let o=g(this.firestore,"teams"),e=yield b(o);this.teams=e.docs.map(t=>({id:t.id,name:t.data().name||"Unnamed"}))})}onTeamSelect(){return c(this,null,function*(){this.selectedTeamId&&(yield this.loadGames(),yield this.loadRoster())})}loadGames(){return c(this,null,function*(){let o=g(this.firestore,`teams/${this.selectedTeamId}/games`),e=yield b(o);this.games=e.docs.map(t=>v({id:t.id},t.data()))})}loadRoster(){return c(this,null,function*(){let o=g(this.firestore,`teams/${this.selectedTeamId}/roster`),e=yield b(o);this.players=e.docs.map(t=>v({id:t.id},t.data()))})}createGame(){return c(this,null,function*(){if(!this.opponent||!this.date||!this.selectedTeamId){alert("Missing team or inputs");return}let o={opponent:this.opponent,date:new Date(this.date),location:"TBD",score:"",teamId:this.selectedTeamId},e=g(this.firestore,`teams/${this.selectedTeamId}/games`);yield D(e,o);let t=g(this.firestore,"games");yield D(t,o),this.opponent="",this.date="",yield this.loadGames()})}selectGame(o){return c(this,null,function*(){if(this.selectedGameId===o){this.selectedGameId=null;return}this.selectedGameId=o,this.playerStatsMap={};for(let e of this.players){let t=M(this.firestore,`teams/${this.selectedTeamId}/games/${o}/stats/${e.id}`),n=yield B(t);this.playerStatsMap[e.id]=n.exists()?n.data():{points:0,assists:0,rebounds:0}}})}saveStats(o){return c(this,null,function*(){if(!this.selectedGameId||!this.selectedTeamId)return;let e=this.playerStatsMap[o],t=M(this.firestore,`teams/${this.selectedTeamId}/games/${this.selectedGameId}/stats/${o}`);yield I(t,e);let n=0;for(let x of Object.values(this.playerStatsMap))n+=x.points;let i=32;this.score=`${n}-${i}`;let d=M(this.firestore,`teams/${this.selectedTeamId}/games/${this.selectedGameId}`);yield I(d,{score:this.score},{merge:!0});let ee=g(this.firestore,"games"),W=(yield b(ee)).docs.find(x=>x.data().teamId===this.selectedTeamId&&x.data().date?.toDate?.().toDateString?.()===new Date(this.date).toDateString());W&&(yield I(W.ref,{score:this.score},{merge:!0}))})}deleteGame(o){return c(this,null,function*(){if(!confirm("Are you sure you want to delete this game and its stats?")||!this.selectedTeamId)return;let t=g(this.firestore,`teams/${this.selectedTeamId}/games/${o}/stats`),n=yield b(t);for(let d of n.docs)yield V(d.ref);let i=M(this.firestore,`teams/${this.selectedTeamId}/games/${o}`);yield V(i),this.selectedGameId===o&&(this.selectedGameId=null),yield this.loadGames()})}static \u0275fac=function(e){return new(e||m)(P(k))};static \u0275cmp=F({type:m,selectors:[["app-games"]],decls:21,vars:6,consts:[[1,"container","mt-4"],[1,"mb-4"],["for","teamSelect",1,"form-label"],["id","teamSelect",1,"form-select",3,"ngModelChange","change","ngModel"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"row","g-2","mb-4",3,"ngSubmit"],[1,"col-md-5"],["type","text","placeholder","Opponent","name","opponent","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-4"],["type","date","name","date","required","",1,"form-control",3,"ngModelChange","ngModel"],[1,"col-md-3"],[1,"btn","btn-success","w-100"],[1,"list-group","mb-4"],["class","list-group-item d-flex justify-content-between align-items-center",4,"ngFor","ngForOf"],[4,"ngIf"],[3,"value"],[1,"list-group-item","d-flex","justify-content-between","align-items-center"],[1,"btn-group"],[1,"btn","btn-sm","btn-outline-primary",3,"click"],[1,"btn","btn-sm","btn-outline-danger",3,"click"],[1,"table","table-bordered"],[4,"ngFor","ngForOf"],["type","number",1,"form-control",3,"ngModelChange","ngModel","name"],[1,"btn","btn-sm","btn-success",3,"click"]],template:function(e,t){e&1&&(a(0,"div",0)(1,"div",1)(2,"label",2),r(3,"Select Team"),s(),a(4,"select",3),y("ngModelChange",function(i){return h(t.selectedTeamId,i)||(t.selectedTeamId=i),i}),w("change",function(){return t.onTeamSelect()}),a(5,"option",4),r(6,"-- Choose a Team --"),s(),C(7,te,2,2,"option",5),s()(),a(8,"form",6),w("ngSubmit",function(){return t.createGame()}),a(9,"div",7)(10,"input",8),y("ngModelChange",function(i){return h(t.opponent,i)||(t.opponent=i),i}),s()(),a(11,"div",9)(12,"input",10),y("ngModelChange",function(i){return h(t.date,i)||(t.date=i),i}),s()(),a(13,"div",11)(14,"button",12),r(15,"Create Game"),s()()(),a(16,"h5"),r(17,"Games"),s(),a(18,"ul",13),C(19,ne,8,2,"li",14),s(),C(20,ae,22,1,"div",15),s()),e&2&&(l(4),f("ngModel",t.selectedTeamId),l(3),S("ngForOf",t.teams),l(3),f("ngModel",t.opponent),l(2),f("ngModel",t.date),l(7),S("ngForOf",t.games),l(),S("ngIf",t.selectedGameId))},dependencies:[R,$,N,Y,U,K,Q,L,H,J,A,j,X,z,q],styles:["[_nghost-%COMP%]{display:block;padding-top:70px;position:relative;z-index:1}"]})};export{Z as GamesComponent};
